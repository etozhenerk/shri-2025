# 2. Соглашения по стилю кода

## Именование
- **Компоненты и страницы:** `PascalCase` (например, `HomePage.tsx`, `HistoryItem.tsx`).
- **Файлы компонентов:** Находятся в папках с таким же названием (`Header/Header.tsx`). Экспортируются через `index.ts` для удобства импорта.
- **Функции и переменные:** `camelCase` (например, `useCsvAnalysis`, `clearHistory`).
- **CSS-модули:** `ComponentName.module.css`.
- **Тесты:**
  - **Функциональные тесты:** Именуются с суффиксом `*.spec.ts`.
  - **Скриншот-тесты:** Именуются с суффиксом `*.screenshot.spec.ts`.
  - **Юнит-тесты:** Находятся в `src/utils/__tests__` с суффиксом `.test.ts`.

## Стиль и архитектура
- **Стилизация:** Используются CSS-модули. Глобальные стили (`src/styles/global.css`) содержат только общие сбросы и переменные.
- **Архитектура компонентов:** Проект разделен на `pages` (страницы приложения), `components` (составные, специфичные для домена компоненты) и `ui` (атомарные, переиспользуемые UI-элементы).
- **Архитектура тестов (Playwright):** Для E2E и скриншотных тестов используется паттерн `Page Object Model (POM)`. Детали реализации описаны в разделе "Тестирование".
- **Модульность и слои:** Проект имеет четкую слоистую архитектуру для разделения ответственности:
  -   `pages`: Верхнеуровневые компоненты-страницы.
  -   `components`: Составные, переиспользуемые компоненты, специфичные для домена.
  -   `ui`: Атомарные, универсальные UI-компоненты (кнопки, иконки, и т.д.).
  -   `store`: Модули управления состоянием (Zustand), разделенные по фичам.
  -   `hooks` / `utils`: Переиспользуемая бизнес-логика и утилиты.
- **Типизация:** Обязательное использование TypeScript. В проекте нет `any`. Типы, связанные с фичами, хранятся рядом с кодом фичи (например, `src/store/analysis/types.ts`).
- **Импорты и пути:** Настроен плагин `simple-import-sort` для автоматической сортировки импортов. Для удобства и избежания относительных путей (`../../../`) используются **псевдонимы (алиасы)**. Они настроены в двух местах:
  -   В `tsconfig.json` (`compilerOptions.paths`) для корректной работы TypeScript и автодополнения в IDE.
  -   В `vite.config.ts` (`resolve.alias`) для корректной сборки проекта.

## Тестирование

### Архитектура тестов (Playwright)
Наша архитектура основана на **Page Object Model (POM)** с четким разделением ответственности.

-   **Page Objects (`/tests/page-objects`)**: Представляют страницы или компоненты. Содержат **только геттеры для локаторов** и наследуются от `BasePage`. Логика взаимодействия в них запрещена.
-   **Actions (`/tests/actions`)**: Инкапсулируют пользовательские сценарии. **НИКОГДА** не должны содержать `expect`. Принимают `pages` в конструкторе для доступа к локаторам.
-   **Фикстуры (`/tests/support/fixtures.ts`)**: Подготавливают и предоставляют в каждый тест готовые объекты (`pages`, `actions`, `mocker`).
-   **Моки (`/tests/mocks/mocker.ts`)**: Класс `Mocker` для перехвата и мокирования сетевых запросов.

### Процесс тестирования (Documentation-First)
1.  **Написание сценария:** Новый функционал сначала описывается в виде пользовательского сценария в `docs/tests/scenarios`. Файлы именуются по названию страницы (например, `HomePage.md`).
2.  **Детализация тест-кейсов:** На основе сценария создаются формальные тест-кейсы с шагами и ожидаемыми результатами в `docs/tests/test-cases`.
3.  **Написание кода:** Только после утверждения документации пишется код автотестов с соответствующим именованием (`*.spec.ts` или `*.screenshot.spec.ts`).
    -   **ID Тест-кейса:** Формат `TC-[PREFIX]-[NNN]`, где `PREFIX` — код страницы (`HP`, `GP`, `HY`), а `NNN` — номер.
    -   **Название теста:** Строго соответствует формату: `test('ID: Название', ...)`.
-   **Именование шагов (`test.step`):** Название шага должно строго соответствовать формату `Шаг [Номер]: [Название из тест-кейса]`. Текст названия должен **полностью, без перефразирования,** соответствовать шагу, описанному в тест-кейсе.
    -   **Пример:** `test.step('Шаг 1: Нажатие на кнопку генерации и проверка состояния загрузки', ...)`
-   **Работа с локаторами:** В Playwright-тестах **ЗАПРЕЩЕНО** использовать "голые" локаторы (`page.getByTestId(...)`). Всегда получайте локаторы из `Page Objects`.
-   **Формат предусловий в тест-кейсах:** Предусловие о нахождении на странице должно быть записано в формате: `Пользователь находится на странице "Имя страницы" ('/url')`.
-   **Обязательные проверки в шагах:** Каждый `test.step` должен содержать как минимум одну проверку (`expect`). Шаг без проверки бессмысленен.
-   **Форматирование шагов:** Внутри `test.step` блок с действиями (actions) должен отделяться от блока с проверками (`expect`) одной пустой строкой.

### Группировка тестов (`describe`)
-   В **Playwright-тестах (`*.spec.ts`)** использование `test.describe()` **ЗАПРЕЩЕНО**. Тесты должны быть на верхнем уровне для обеспечения "плоской" структуры.
-   В **Unit- и Интеграционных тестах (`*.test.ts`)** использование `describe()` **ОБЯЗАТЕЛЬНО** для группировки связанных тестов для функции, компонента или страницы.

### Паттерн AAA (Arrange-Act-Assert)
Все тесты в проекте, независимо от их типа (E2E, интеграционные, юнит-тесты), должны строго следовать паттерну **Arrange-Act-Assert**. Это повышает читаемость и упрощает поддержку тестов.

-   **Arrange (Подготовка):** В этом блоке готовится всё необходимое для теста: создаются моки, инициализируются данные, рендерятся компоненты.
-   **Act (Действие):** В этом блоке выполняется одно-единственное ключевое действие, которое мы тестируем: вызов функции, клик по кнопке, симуляция события.
-   **Assert (Проверка):** В этом блоке проверяется результат выполнения действия: `expect(...)`.

Для наглядности блоки **Act** и **Assert** должны быть визуально отделены от **Arrange** одной пустой строкой. 