# 2. Соглашения по стилю кода

## Именование
- **Компоненты и страницы:** `PascalCase` (например, `HomePage.tsx`, `HistoryItem.tsx`).
- **Файлы компонентов:** Находятся в папках с таким же названием (`Header/Header.tsx`). Экспортируются через `index.ts` для удобства импорта.
- **Функции и переменные:** `camelCase` (например, `useCsvAnalysis`, `clearHistory`).
- **CSS-модули:** `ComponentName.module.css`.
- **Тесты:**
  - **E2E тесты:** Именуются с суффиксом `*.spec.ts` и лежат в `tests/functional`.
  - **UI-снэпшот тесты:** Именуются с суффиксом `*.spec.ts` и лежат в `packages/ui-kit/__tests__`.
  - **Юнит- и интеграционные тесты:** Находятся в `__tests__` рядом с тестируемым кодом, с суффиксом `.test.ts`.

## Стиль и архитектура
- **Стилизация:** Используются CSS-модули. Глобальные стили (`src/styles/global.css`) содержат только общие сбросы и переменные.
- **Архитектура компонентов:** Проект разделен на `pages` (страницы приложения), `components` (составные, специфичные для домена компоненты в основном приложении) и `@shri/ui-kit` (атомарные, переиспользуемые UI-элементы в отдельном пакете).
- **Архитектура тестов (Playwright):** Вся логика для E2E и UI-тестов (Page Objects, Actions, фикстуры) инкапсулирована в пакете `@shri/playwright`.
- **Модульность и слои:** Проект имеет четкую слоистую архитектуру:
  -   `pages`: Верхнеуровневые компоненты-страницы.
  -   `components`: Составные, переиспользуемые компоненты, специфичные для домена.
  -   `@shri/ui-kit`: Атомарные, универсальные UI-компоненты.
  -   `store`: Модули управления состоянием (Zustand), разделенные по фичам.
  -   `hooks` / `utils`: Переиспользуемая бизнес-логика и утилиты.
- **Типизация:** Обязательное использование TypeScript. В проекте нет `any`. Типы, связанные с фичами, хранятся рядом с кодом фичи (например, `src/store/analysis/types.ts`).
- **Импорты и пути:** Настроен плагин `simple-import-sort` для автоматической сортировки импортов. Для удобства и избежания относительных путей (`../../../`) используются **псевдонимы (алиасы)**. Они настроены в двух местах:
  -   В `tsconfig.json` (`compilerOptions.paths`) для корректной работы TypeScript и автодополнения в IDE.
  -   В `vite.config.ts` (`resolve.alias`) для корректной сборки проекта.

## Тестирование

### Архитектура тестов (Playwright)
Наша архитектура основана на **Page Object Model (POM)** и полностью инкапсулирована в пакете `@shri/playwright`.

-   **Page Objects**: Представляют страницы или компоненты. Содержат **только геттеры для локаторов**.
-   **Actions**: Инкапсулируют пользовательские сценарии. **НИКОГДА** не должны содержать `expect`.
-   **Фикстуры**: Пакет `@shri/playwright` предоставляет кастомный объект `test`, который автоматически передает в каждый тест `pages`, `actions` и `mocker`.

### Процесс тестирования (Documentation-First)

**Исключение:** Данный процесс **не распространяется** на UI-снэпшот тесты из пакета `@shri/ui-kit`. Для них не требуются формальные тест-кейсы в `docs/` и, соответственно, не используется префикс `TC-ID` в названии. Названия тестов должны быть описательными и на русском языке.

1.  **Написание сценария:** Новый функционал сначала описывается в виде пользовательского сценария в `docs/tests/scenarios`. Файлы именуются по названию страницы (например, `HomePage.md`).
2.  **Детализация тест-кейсов:** На основе сценария создаются формальные тест-кейсы с шагами и ожидаемыми результатами в `docs/tests/test-cases`.
3.  **Написание кода:** Только после утверждения документации пишется код автотестов с соответствующим именованием (`*.spec.ts`).
    -   **ID Тест-кейса:** Формат `TC-[PREFIX]-[NNN]`, где `PREFIX` — код страницы (`HP`, `GP`, `HY`), а `NNN` — номер.
    -   **Название теста:** Строго соответствует формату: `test('ID: Название', ...)`.
-   **Именование шагов (`test.step`):** Название шага должно строго соответствовать формату `Шаг [Номер]: [Название из тест-кейса]`. Текст названия должен **полностью, без перефразирования,** соответствовать шагу, описанному в тест-кейсе.
    -   **Пример:** `test.step('Шаг 1: Нажатие на кнопку генерации и проверка состояния загрузки', ...)`
-   **Работа с локаторами:** В Playwright-тестах **ЗАПРЕЩЕНО** использовать "голые" локаторы (`page.getByTestId(...)`). Всегда получайте локаторы из `Page Objects`.
-   **Формат предусловий в тест-кейсах:** Предусловие о нахождении на странице должно быть записано в формате: `Пользователь находится на странице "Имя страницы" ('/url')`.
-   **Обязательные проверки в шагах:** Каждый `test.step` должен содержать как минимум одну проверку (`expect`). Шаг без проверки бессмысленен.
-   **Форматирование шагов:** Внутри `test.step` блок с действиями (actions) должен отделяться от блока с проверками (`expect`) одной пустой строкой.

### Группировка тестов (`describe`)
-   В **Playwright-тестах (`*.spec.ts`)** использование `test.describe()` **ЗАПРЕЩЕНО**. Тесты должны быть на верхнем уровне для обеспечения "плоской" структуры.
-   В **Unit- и Интеграционных тестах (`*.test.ts`)** использование `describe()` **ОБЯЗАТЕЛЬНО** для группировки связанных тестов для функции, компонента или страницы.

### Паттерн AAA (Arrange-Act-Assert)
Все тесты в проекте, независимо от их типа (E2E, интеграционные, юнит-тесты), должны строго следовать паттерну **Arrange-Act-Assert**. Это повышает читаемость и упрощает поддержку тестов.

-   **Arrange (Подготовка):** В этом блоке готовится всё необходимое для теста: создаются моки, инициализируются данные, рендерятся компоненты.
-   **Act (Действие):** В этом блоке выполняется одно-единственное ключевое действие, которое мы тестируем: вызов функции, клик по кнопке, симуляция события.
-   **Assert (Проверка):** В этом блоке проверяется результат выполнения действия: `expect(...)`.

Для наглядности блоки **Act** и **Assert** должны быть визуально отделены от **Arrange** одной пустой строкой. 