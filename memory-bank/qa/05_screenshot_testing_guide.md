# Руководство по скриншотному тестированию (Playwright)

Этот документ описывает технические правила и лучшие практики для реализации скриншотных регрессионных тестов. **Все общие правила, включая процесс "Documentation-First", архитектуру POM и структуру тестов, описаны в [главном документе по конвенциям](../02_coding_conventions.md).**

## 1. Основные принципы

-   **Инструмент:** Используется встроенная в Playwright функция `expect(page).toHaveScreenshot()`.
-   **Расположение тестов:** Все скриншот-тесты должны находиться в директории `tests/` и иметь суффикс `*.screenshot.spec.ts`.

## 2. Работа с эталонными снимками (Snapshots)

-   **Хранение:** Эталонные снимки (`*.png`) хранятся в репозитории, в соответствующих подпапках `*-snapshots`.
-   **Создание и обновление:** Для создания новых или обновления существующих снимков используется команда:
    ```bash
    npx playwright test --update-snapshots
    ```
-   **Именование:** Имя для скриншота должно быть осмысленным и отражать его содержимое, например, `home-page-default.png`.

## 3. Обработка динамических данных

-   **Проблема:** Элементы с динамическим контентом (даты, ID) будут ломать тесты.
-   **Решение:** Такие элементы необходимо "маскировать" с помощью опции `mask` в `toHaveScreenshot`. Маска закрашивает указанные элементы розовым цветом, исключая их из сравнения.
-   **Пример маскировки:**
    ```typescript
    await expect(pages.historyModal.modalContainer).toHaveScreenshot('history-modal.png', {
        mask: [
            pages.historyModal.modalDate,
            pages.historyModal.highlightCardsContainer
        ],
    });
    ```

## 4. CI/CD

-   Скриншотные тесты должны запускаться на CI вместе с остальными.
-   Команда `--update-snapshots` **никогда** не должна использоваться на CI. Обновление эталонов — это всегда осознанное действие разработчика. 