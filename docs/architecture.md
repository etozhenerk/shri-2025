# Архитектура проекта

## Обзор

Проект построен по принципу **монорепозитория** с использованием `npm workspaces`. Эта архитектура разделяет основное приложение, переиспользуемую библиотеку UI-компонентов и утилиты для тестирования. Такой подход способствует лучшей модульности, переиспользованию кода и упрощению CI/CD процессов.

```mermaid
graph TD
    A[Монорепозиторий] --> B{Приложение};
    A --> C{packages};
    C --> D[@shri/ui-kit];
    C --> E[@shri/playwright];
    B --> D;
    B --> E;
    D --> E;
```

## Структура

Монорепозиторий состоит из трех ключевых частей:

### 1. Основное приложение (корень проекта)

-   **Расположение:** `/`
-   **Ответственность:** Является контейнером для всего приложения. Здесь сосредоточена бизнес-логика, интеграция компонентов, страницы и управление состоянием.
-   **Ключевые директории:**
    -   `src/pages`: Компоненты страниц, соответствующие разным роутам.
    -   `src/components`: Сложные, составные компоненты, специфичные для домена приложения.
    -   `src/store`: Глобальное управление состоянием.
    -   `tests`: Директория для E2E и скриншот-тестов всего приложения (кроме UI-kit).

### 2. Пакет `@shri/ui-kit`

-   **Расположение:** `packages/ui-kit`
-   **Ответственность:** Предоставляет набор изолированных, переиспользуемых UI-компонентов (атомарных и молекулярных), которые не зависят от бизнес-логики.
-   **Ключевые особенности:**
    -   **Изоляция:** Имеет собственный `package.json` и управляет своими зависимостями.
    -   **Инкапсуляция разработки и тестирования:**
        -   **Storybook:** Для каждого компонента создаются "истории" (`__stories__`), позволяя разрабатывать и визуально тестировать компоненты в изоляции.
        -   **UI-тестирование:** Содержит собственные UI-снэпшот-тесты (`__tests__`), которые проверяют визуальную стабильность компонентов.
    -   **Подробнее:** [Документация по @shri/ui-kit](./packages/ui-kit/index.md)
    -   **Стратегия тестирования:** [Стратегия тестирования UI-компонентов](./packages/ui-kit/testing-strategy.md)

### 3. Пакет `@shri/playwright`

-   **Расположение:** `packages/playwright`
-   **Ответственность:** Предоставляет единую точку входа и набор утилит (Page Objects, Actions, Mocker) для написания Playwright-тестов.
-   **Ключевые особенности:**
    -   **Централизованные фикстуры:** Экспортирует кастомный объект `test`, который автоматически предоставляет всем тестам доступ к утилитам через параметры теста.
    -   **Единый импорт:** Все необходимое для теста импортируется из одной точки: `import { test, expect } from '@shri/playwright';`
    -   **Подробнее:** [Документация по @shri/playwright](./packages/playwright/index.md)

### 4. API-слой

-   **Расположение:** `src/api`
-   **Ответственность:** Инкапсулирует всю логику взаимодействия с бэкенд-сервисами. Является **единственной точкой входа** для всех сетевых запросов в приложении.
-   **Ключевые особенности:**
    -   **Изоляция:** Модули этого слоя не зависят от React, хуков или глобального состояния. Они работают с чистыми данными и возвращают их или выбрасывают стандартизированные ошибки.
    -   **Тестируемость:** Такая архитектура позволяет легко тестировать как сам API-слой (юнит-тесты с моками `client.ts`), так и компоненты, которые его используют (интеграционные тесты с моками API).
    -   **Структура:**
        -   `client.ts`: Низкоуровневая, минималистичная обертка над `fetch`, которая возвращает необработанный `Response`.
        -   `analysis.ts`: Высокоуровневый модуль для эндпоинта `/aggregate`. Использует асинхронную модель с колбэками (`onData`, `onComplete`, `onError`) для обработки потоковых ответов (ndjson).
        -   `report.ts`: Высокоуровневый модуль для эндпоинта `/report`, который отвечает за генерацию отчетов.
        -   `index.ts`: Единый фасад, экспортирующий все API-модули (например, `api.analysis.analyzeCsv()`).

## Рабочие процессы

-   **Импорт:** Пакеты и приложение импортируют зависимости друг от друга как обычные npm-пакеты. `npm workspaces` обеспечивает связывание.
-   **Запуск Storybook:** `npm run storybook`
-   **Запуск UI-тестов:** `npm run test:ui-snapshot`
-   **Запуск E2E-тестов:** `npm run test:e2e` 