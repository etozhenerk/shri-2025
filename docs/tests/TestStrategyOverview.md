# Обзор стратегии тестирования

Этот документ описывает принятую в проекте стратегию тестирования, включая классификацию тестов, их критичность и принципы выбора типа теста для конкретного сценария.

## 1. Типы тестов и их назначение

Мы выделяем три основных типа автоматизированных тестов:

1.  **Интеграционные тесты (Integration Tests):**
    *   **Технология:** Vitest + React Testing Library (RTL).
    *   **Цель:** Проверка корректной работы нескольких компонентов, хуков и сторов в связке.
    *   **Среда:** Эмуляция DOM через `jsdom`, без реального браузера.
    *   **Принцип работы:**
        ```mermaid

        graph TD;
            A["Код теста"] --> B("render");
            B --> C{"Компонент A"};
            C --> D["Компонент B"];
            C --> E["Хук/Стор"];
            A --> F("fireEvent");
            F --> C;
            A --> G("expect");
            G --> C;
        
        ```
    *   **Когда использовать:** Для проверки логики, взаимодействия компонентов, обработки состояний и асинхронных операций. Это наш **основной** тип тестов для проверки функциональности.

2.  **Скриншотные тесты (Screenshot Tests):**
    *   **Технология:** Playwright.
    *   **Цель:** Проверка визуального соответствия компонентов или целых страниц эталонным снимкам. Гарантия, что верстка не "поехала".
    *   **Среда:** Реальный браузер.
    *   **Когда использовать:** Для проверки ключевых визуальных состояний интерфейса (страница по умолчанию, с данными, с ошибкой, модальные окна).

3.  **End-to-End (E2E) тесты:**
    *   **Технология:** Playwright.
    *   **Цель:** Проверка самых критичных, сквозных пользовательских сценариев, проходящих через несколько страниц и систем.
    *   **Среда:** Реальный браузер.
    *   **Принцип работы (наш подход):**
        ```mermaid

        graph TD;
            A["Пользователь в браузере<br/>(эмулируется Playwright)"] --> B{"Frontend-приложение"};
            B --> C["Mock API<br/>(Перехватчики Playwright)"];
            C --> B;
            B --> A;
        
        ```
    *   **Когда использовать:** Только для самых важных путей, которые невозможно или нецелесообразно проверять на других уровнях (например, полный цикл "логин -> действие -> выход"). В нашем проекте таких тестов **минимальное** количество в пользу более быстрых и стабильных интеграционных тестов.

## 2. Принципы выбора типа теста

Ключевой принцип — **использовать самый низкоуровневый, быстрый и стабильный тест, который может адекватно проверить нужный функционал.**

При выборе типа теста мы задаем себе вопрос:

> **"Нужен ли для этой проверки реальный браузер?"**

*   Если ответ **"нет"** (мы проверяем логику, состояние, взаимодействие компонентов) ➡️ **Интеграционный тест**.
*   Если ответ **"да"** (мы проверяем верстку, стили, анимации) ➡️ **Скриншотный тест**.
*   Если ответ **"да, и нам нужно проверить путь через несколько страниц"** ➡️ **E2E тест**.

## 3. Общие принципы написания тестов

Независимо от выбранного типа, все тесты в проекте должны следовать нескольким ключевым принципам для обеспечения их качества, читаемости и поддерживаемости.

-   **Паттерн Arrange-Act-Assert (AAA):** Это основа структуры каждого теста.
    -   **Arrange (Подготовка):** Подготавливаются все условия — данные, моки, состояние.
    -   **Act (Действие):** Выполняется одно, целевое действие (клик, вызов функции).
    -   **Assert (Проверка):** Проверяется результат этого действия.
    Этот подход делает тесты предсказуемыми и легкими для понимания.

-   **Изоляция:** Каждый тест должен быть независим от других. Результат одного теста не должен влиять на результат следующего. Это достигается за счет сброса состояния, пересоздания моков и навигации на нужную страницу перед каждым тестом (в блоках `beforeEach`).

-   **Ясные и полные названия:** Название теста должно четко описывать, какой именно сценарий он проверяет. В идеале, прочитав только названия тестов в файле, можно понять весь функционал модуля.

## 4. Аудит и классификация тест-кейсов

Ниже представлена таблица со всеми тест-кейсами проекта, их типом и обоснованием выбора.

| ID | Название | Тип теста | Критичность | Обоснование выбора |
| :--- | :--- | :--- | :--- | :--- |
| **HomePage** |
| TC-HP-001 | Успешная загрузка (кнопка) | Функциональный (E2E) | **Высокая** | Проверяет полный пользовательский сценарий. Требует браузер для сквозной проверки. |
| TC-HP-002 | Успешная загрузка (D&D) | Функциональный (E2E) | **Высокая** | Аналогично TC-HP-001. |
| TC-HP-003 | Загрузка файла неверного формата | Интеграционный | **Высокая** | Ключевая проверка логики валидации. **Уже преобразован.** |
| TC-HP-004 | Неактивность кнопки "Отправить" | Интеграционный | **Средняя** | Проверка условного рендеринга и состояния. |
| TC-HP-005 | Отображение серверной ошибки | Интеграционный | **Высокая** | Проверка корректной обработки ошибок от API. |
| TC-HP-006 | Сброс выбранного файла | Интеграционный | **Средняя** | Проверка логики сброса состояния в UI. |
| TC-HP-007 | Скриншот: состояние по умолчанию | Скриншотный | **Высокая** | Фиксация базового вида страницы. |
| TC-HP-008 | Скриншот: состояние с результатами | Скриншотный | **Высокая** | Фиксация вида страницы в ключевом успешном состоянии. |
| TC-HP-009 | Скриншот: состояние с ошибкой | Скриншотный | **Средняя** | Фиксация вида страницы в состоянии ошибки. |
| **GeneratePage** |
| TC-GP-001 | Успешная генерация и скачивание | Функциональный (E2E) | **Высокая** | Проверка скачивания файла — это браузерная функциональность, требующая E2E теста. |
| TC-GP-002 | Ошибка генерации | Интеграционный | **Высокая** | Проверка обработки ошибок от API. |
| TC-GP-003 | Скриншот: состояние по умолчанию | Скриншотный | **Высокая** | Фиксация базового вида страницы. |
| **HistoryPage** |
| TC-HY-001 | Отображение списка записей | Интеграционный | **Высокая** | Проверка рендеринга данных из `localStorage`. |
| TC-HY-002 | Открытие/закрытие модального окна | Интеграционный | **Высокая** | Ключевая проверка взаимодействия UI и модальных окон. |
| TC-HY-003 | Удаление одной записи | Интеграционный | **Средняя** | Проверка логики изменения данных в `localStorage`. |
| TC-HY-004 | Полная очистка истории | Интеграционный | **Средняя** | Проверка логики полного сброса данных. |
| TC-HY-005 | Клик по записи с ошибкой | Интеграционный | **Низкая** | Проверка отсутствия реакции на клик. |
| TC-HY-006 | Переход на страницу генерации | Интеграционный | **Средняя** | Проверка навигации (`<Link>`). |
| TC-HY-007 | Отображение пустой страницы | Интеграционный | **Низкая** | Проверка условного рендеринга для "пустого" состояния. |
| TC-HY-008 | Скриншот: с заполненным списком | Скриншотный | **Высокая** | Фиксация базового вида страницы с данными. |
| TC-HY-009 | Скриншот: модальное окно | Скриншотный | **Высокая** | Фиксация вида ключевого элемента UI. |
| TC-HY-010 | Скриншот: пустая страница | Скриншотный | **Средняя** | Фиксация вида "пустого" состояния. | 